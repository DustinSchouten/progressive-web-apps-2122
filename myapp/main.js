require("dotenv").config();const express=require("express"),fetch=(...e)=>import("node-fetch").then(({default:t})=>t(...e)),compression=require("compression"),app=express();app.set("view engine","ejs"),app.set("views","./views"),app.use(express.static("public"));let setCache=function(e,t,o){"GET"==e.method?t.set("Cache-control","public, max-age=2628000"):t.set("Cache-control","no-store"),o()};function shouldCompress(e,t){return!e.headers["x-no-compression"]&&compression.filter(e,t)}app.use(setCache),app.use(compression({filter:shouldCompress})),app.get("/",function(e,t){t.render("index",{pageTitle:"homepage",quote:{text:"The app for the best and most inspirational quotes!"},quote_text_fontsize:"1.75em"})}),app.get("/quotes",function(e,t){fetchJson("https://quote.api.fdnd.nl/v1/quote").then(function(e){e=e.filter(e=>e.text.length>10),t.render("quotes",{pageTitle:"overviewpage",data:e})})}),app.get("/quote/:id",function(e,t){fetchJson("https://quote.api.fdnd.nl/v1/quote").then(function(o){let n=e.params.id.split(":")[1],s="1.75em";o[n].text.length>100&&(s="1.4em");let a=o[n].avatar||"/images/image_skeleton.png",p="/images/"+o[n].authorId+".jpg";"/images/image_skeleton.png"==a&&(p="/images/image_skeleton.png"),t.render("quote",{pageTitle:"quotepage",quote:o[n],quote_text_fontsize:s,image_avatar_normal:a,image_avatar_smaller:p})})}),app.get("/offline",function(e,t){t.render("offline",{pageTitle:"offline",quote:{text:"Life is what happens, when you go offline..."},quote_text_fontsize:"1.75em"})}),app.set("port",process.env.PORT||8e3);const server=app.listen(app.get("port"),function(){console.log(`Application started on port: ${app.get("port")}`)});async function fetchJson(e){return await fetch(e).then(e=>e.json()).then(e=>e.data).catch(e=>e)}